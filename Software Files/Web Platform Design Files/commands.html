<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="styles/Light-BS-dashboard-CT/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="styles/Light-BS-dashboard-CT/assets/img/favicon.ico">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Connected Farms Commands</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="styles/Light-BS-dashboard-CT/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="styles/Light-BS-dashboard-CT/assets/css/light-bootstrap-dashboard.css?v=2.0.0 " rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <!-- <link href="styles/Light-BS-dashboard-CT/assets/css/demo.css" rel="stylesheet" /> -->
    <script src="https://dde-us-south.analytics.ibm.com/daas/CognosApi.js"></script>
    <script src='scripts/main.js'></script>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-color="green" data-image="styles/Light-BS-dashboard-CT/assets/img/corn.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a href="javascript:;" class="simple-text">
                      Connected Farms
                    </a>
                </div>
                <ul class="nav">
                    <li>
                        <a class="nav-link" href="./main.html">
                            <i class="nc-icon nc-sun-fog-29"></i>
                            <p>Main Page</p>
                        </a>
                    </li>
                    <li>
                        <a class="nav-link" href="./graphs.html">
                            <i class="nc-icon nc-chart-pie-36"></i>
                            <p>Graphs</p>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="commands.html">
                            <i class="nc-icon nc-settings-gear-64"></i>
                            <p>Device Commands</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#pablo">Device Commands</a>
                    <button href="" class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                        <span class="navbar-toggler-bar burger-lines"></span>
                    </button>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">
                        <!-- <ul class="nav navbar-nav mr-auto">
                            <li class="dropdown nav-item">
                                <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                                    <i class="nc-icon nc-planet"></i>
                                    <span class="notification">5</span>
                                    <span class="d-lg-none">Notification</span>
                                </a>
                                <ul class="dropdown-menu">
                                    <a class="dropdown-item" href="#">Plot 1 is in drought</a>
                                    <a class="dropdown-item" href="#">Plot 1 put to sleep</a>
                                    <a class="dropdown-item" href="#">Plot 1 has sufficient watter</a>
                                    <a class="dropdown-item" href="#">Plot 1 is in drought</a>
                                    <a class="dropdown-item" href="#">Plot 1 put to sleep<</a>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a href="#" class="nav-link">
                                    <i class="nc-icon nc-zoom-split"></i>
                                    <span class="d-lg-block">&nbsp;Search</span>
                                </a>
                            </li>
                        </ul> -->
                        <ul class="navbar-nav ml-auto">
                            
                            <!--
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <span class="no-icon">Dropdown</span>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">Action</a>
                                    <a class="dropdown-item" href="#">Another action</a>
                                    <a class="dropdown-item" href="#">Something</a>
                                    <a class="dropdown-item" href="#">Something else here</a>
                                    <div class="divider"></div>
                                    <a class="dropdown-item" href="#">Separated link</a>
                                </div>
                            </li>
                            -->
                            <li class="nav-item">
                                <a class="nav-link" href="./index.html">
                                    <span class="no-icon">Log Out</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->

            <!-- Content -->
            <div class="content">
            	<!--
	            <div id="commands">
			        <form id=commands_form>
			            Select Command for Camera 9: 
			            <select id="select_commands" name="commands" size="1">
			                <option value='default'>---</option>
			                
			                <option value='CommandType=resizeImage&Height=400&Width=400'>resizeImage</option>
			                <option value='CommandType=changeSendInterval&Interval=15'>changeSendInterval</option>
			                <option value='CommandType=takeImage'>takeImage</option>
			                <option value='CommandType=setupDate'>setupDate</option>
			                <option value='CommandType=downloadImages'>downloadImages</option>
			                <option value='CommandType=sendThumbnail'>sendThumbnail</option>
			                <option value='CommandType=sendData'>sendData</option>
			                <option value='CommandType=runScript&scriptType=exampleScript'>runScript</option>
			                <option value='CommandType=idleMode'>idleMode</option>
			                <option value='CommandType=sendStatus'>sendStatus</option>
			            </select> 
			            
			        </form>
			        <button onclick="submitHandler()">
			            Submit
			        </button>
			        <button onclick="resetForm()">
			            Reset
			        </button>
			    </div>
			    <br>
			    -->
			    <div id="comands">
			        Select which camera to command: 
			        <select id="select_camera" name="camera" size="1">
			            <option value='1'>1</option>
			            <option value='2'>2</option>
			        </select> 
			        <br/>

			        Height: <input type="number" id='input_image_height'>
			        Width: <input type="number" id='input_image_width'>
			        <button onclick="sendResizeImage()">
			            Resize Image
			        </button>
			        <br/>
			        
			        Start Time: <input type="time" id="input_startTime" name="set_startTime">
			        End Time: <input type="time" id="input_endTime" name="set_endTime">
			        <button onclick="sendTime()">
			           Change Schedule
			        </button>
			        <br/>
			        
			        Set interval:
			        <select id="input_interval" name="interval" size="1">
			            <option value='5'>5 minutes</option>
			            <option value='10'>10 minutes</option>
			            <option value='15'>15 minutes</option>
			            <option value='30'>30 minutes</option>
			            <option value='60'>60 minutes</option>
			        </select>
			        <button onclick="sendChangeInterval()">
			            Change Interval
			        </button>
			        <br/>
			        
			        Change image resolution: 
			        <select id="select_resolution" name="resolution" size="1">
			            <option value='1'>1920x1080</option>
			            <option value='2'>1296x972</option>
			            <option value='3'>1296x730</option>
			            <option value='4'>640x480</option>
			        </select>
			        <button onclick="sendResolution()">
			            Change Resolution
			        </button>
			        <br/>
			        
			        Select image type: 
			        <select id="select_imageType" name="imageType" size="1">
			            <option value='.jpg'>.jpg</option>
			            <option value='.png'>.png</option>
			            <option value='.raw'>.raw</option>
			        </select>
			        <button onclick="sendImageFormat()">
			            Set Image Format
			        </button>
			        <br/>
			        
			        Select script to run: 
			        <select id="select_script" name="script" size="1">
			            <option value='takeImage.py'>takeImage</option>
			            <option value='mlx90614.py'>IRT Sensor</option>
			            <option value='veml7700.py'>LUX Sensor</option>
			            <option value='synchTime.sh'>Sync Time</option>
			            <option value='reboot.sh'>Reboot</option>
			        </select>
			        <button onclick="sendRunScript()">
			            Run Script
			        </button>
			        <br/>
			        
			        Frames per second:
			        <select id="select_frames" name="frames" size="1">
			            <option value='10'>10 fps</option>
			            <option value='15'>15 fps</option>
			            <option value='30'>30 fps</option>
			        </select>
			        <button onclick="sendChangeFrames()">
			            Set Frames
			        </button>
			        <br/>
			        
			        <!--
			        Set date: <input type="date" id="input_date" name="set_date">
			        <button onclick="sendSetDate()">
			           Set Date
			        </button>
			        <br/>
			        -->
			        
			        <button onclick="sendSimpleHandler('takeImage')">
			            Take Image
			        </button>
			        <br/>
			        
			        <button onclick="sendSimpleHandler('sendData')">
			            Send Data
			        </button>
			  		 <br/>
			   
			         <button onclick="populateStatus()">
			            Check Camera Status
			        </button>
			        <div id=outputDiv>
			        Output Here
			        </div><div id=statusDiv>
			        Camera Status Here
			        </div>
			        
			        <!--
			        <button onclick="sendSimpleHandler('sendThumbnail')">
			            Send Thumbnail
			        </button>
			        <br/>
			        
			        <button onclick="sendSimpleHandler('downloadImages')">
			            Download Images
			        </button>
			        <br/>
			        -->
			        
			        
			        
			    </div>
			    <br>
            </div>
 
            <!-- Footer -->
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <ul class="footer-menu">
                            <li>
                                <a href="#">
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Contact Us
                                </a>
                            </li>
                        </ul>
                        <p class="copyright text-center">
                            Â©
                            <script>
                                document.write(new Date().getFullYear());
                            </script>
                            Connected Farms
                        </p>
                    </nav>
                </div>
            </footer>
        </div>
    </div>
</body>


<!--   Core JS Files   -->
		<script type="text/javascript">
			function populateOutput(outputString){
				document.getElementById("outputDiv").innerText = outputString;

			}
            function sendSimpleHandler(commandType) {
                console.log('Command: '+commandType);
                
                var payload = 'CommandType='+commandType;
                sendRequest(payload, commandType);
                
            }
            
            function sendResizeImage() {
                console.log('Command: resize');
                
                var height = document.getElementById("input_image_height").value;
                var width = document.getElementById("input_image_width").value;
                
                console.log(height,width);

                var payload = 'CommandType=resizeImage&Height='+ height +'&Width=' + width;
                sendRequest(payload,"Resize Image");
            }
            
            function sendChangeInterval() {
                console.log('Command: change interval');
                
                var select = document.getElementById("input_interval");
                var interval = select.options[select.selectedIndex].value;
                console.log(interval);

                var payload = 'CommandType=changeSendInterval&Interval='+interval;
                sendRequest(payload, "Change Interval");
            }
            
            function sendRunScript() {
                console.log('Command: runScript');
                
                var select = document.getElementById("select_script");
                var scriptID = select.options[select.selectedIndex].value;
                console.log(scriptID);

                var payload = 'CommandType=runScript&scriptType=' + scriptID;                
                sendRequest(payload, "Run Script");
            }
            
            function sendTime() {
                console.log('Command: changeSchedule');
                
                var startTime = document.getElementById("input_startTime").value;
                var endTime = document.getElementById("input_endTime").value;
                
                console.log(startTime, endTime);

                var payload = 'CommandType=changeSchedule&startTime='+ startTime +'&endTime=' + endTime;
                sendRequest(payload, "Change Schedule");
            }

            function sendSetDate() {
                console.log('Command: set date');
                
                var date = document.getElementById("input_date").value;
                console.log(date);

                var payload = 'CommandType=setDate&Date=' + date;
                sendRequest(payload, "Change Date");
            }
            
            function sendImageFormat() {
                console.log('Command: imageFormat');
                
                var select = document.getElementById("select_imageType");
                var imageType = select.options[select.selectedIndex].value;
                console.log(imageType);

                var payload = 'CommandType=imageFormat&imageFormat=' + imageType;                
                sendRequest(payload, "Set Image Format");
            }
            
            function sendChangeFrames() {
                console.log('Command: change frames');
                
                var select = document.getElementById("select_frames");
                var frames = select.options[select.selectedIndex].value;
                console.log(frames);

                var payload = 'CommandType=changeFrames&frames='+frames;
                sendRequest(payload, "Set Frames");
            }

            function sendResolution() {
                console.log('Command: changeResolution');
                
                var height;
                var width;
                var select = document.getElementById("select_resolution");
                var value = String(select.options[select.selectedIndex].value);
                console.log(select,value);
                switch(value)
				{
				   case '1':
				     height = 1920;
				     width = 1080;
				     break;
				   case '2':
				     height = 1286;
				     width = 972;
				     break;
				   case '3':
				     height = 1296;
				     width = 730;
				     break;
				   case '4':
				     height = 640;
				     width = 480;
				     break;
				}
                console.log(height,width);

                var payload = 'CommandType=changeResolution&imageResolutionX='+ height +'&imageResolutionY=' + width;
                sendRequest(payload, "Change Resolution");
            }
            
            
			/*
            function sendRequestOld(payload) {
                console.log('submitting');
                var request = new XMLHttpRequest();
                
                //here determine which camera url to use
                var select = document.getElementById("select_camera");
                var cameraNumber = select.options[select.selectedIndex].value;
                

                //request.open('POST', 'https://connectedfarmsnodered.mybluemix.net/command', true)
                request.open('POST', 'https://us-south.functions.cloud.ibm.com/api/v1/web/ORG_NCSU_CF_dev/ConnectedFarms/nodered-authentication', true);
                //request.open('POST', 'https://connectedfarmsnodered.mybluemix.net/command'+cameraNumber, true)
                request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                //request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                request.onload = function() {
                    var data = this.response;
                    console.log(data);
                };
                var finalPayload = {
                	"body":{             	
	                		"noderedPayload":payload, 
		              		"username": sessionStorage.getItem("username"),
							"password": sessionStorage.getItem("password"),
							"role": sessionStorage.getItem("role")
                	}
                };
                console.log(finalPayload);
                request.send(finalPayload);
            }
            */
	        async function postData(url, data) {
			  // Default options are marked with *
			  const response = await fetch(url, {
				method: 'POST', // *GET, POST, PUT, DELETE, etc.
				mode: 'cors', // no-cors, *cors, same-origin
				cache: 'no-cache', // *default, no-cache, reload, force-cache, only-if-cached
				headers: {
				  'Content-Type': 'application/json'
				},
				body: JSON.stringify(data) // body data type must match "Content-Type" header
			  });
			  return response.json(); // parses JSON response into native JavaScript objects
			}
			
			function sendRequest(payload, commandType) {
				populateStatus();
	            console.log('Submitting');
	            
	            //here determine which camera url to use
	            var select = document.getElementById("select_camera");
	            var cameraNumber = select.options[select.selectedIndex].value;
	            
				var url = 'https://us-south.functions.cloud.ibm.com/api/v1/web/ORG_NCSU_CF_dev/ConnectedFarms/nodered-authenticationV2';
	            var finalPayload = {
	            	"body":{             	
	                		"noderedPayload":payload, 
		              		"username": sessionStorage.getItem("username"),
							"password": sessionStorage.getItem("password"),
							"role": sessionStorage.getItem("role"),
							"cameraNumber": cameraNumber
	            	}
	            };
				
				console.log('submitting', finalPayload);
				
				postData(url, finalPayload)
					.then((data) => {
						console.log(data); // JSON data parsed by `response.json()` call
						if(data['success']){
							populateOutput("Command Received: "+commandType)
						}
						else {
							populateOutput("Command Failed: "+commandType+": "+data["message"])
						}
					
					})
					.catch((error) => {
						console.log(error);// This is where you run code if the server returns any errors
					});
			}
function populateStatus() {
				var url = "https://us-south.functions.cloud.ibm.com/api/v1/web/ORG_NCSU_CF_dev/ConnectedFarms/nodered-authenticationV2"
	            console.log('Submitting Check Camera Status');
	            var select = document.getElementById("select_camera");
	            var cameraNumber = select.options[select.selectedIndex].value;
	            var finalPayload = {
	            	"body":{             	
	                
		              		"username": sessionStorage.getItem("username"),
							"password": sessionStorage.getItem("password"),
							"role": sessionStorage.getItem("role"),					
							"checkCamera":true,
							"cameraNumber":cameraNumber
	            	}
            	};

	          	var result = "No Result"
				postData(url, finalPayload)
					.then((data) => {
						console.log(data); // JSON data parsed by `response.json()` call;
						if (data["noderedResponse"].indexOf("Cannot GET")===-1){
							var cameraStatus = JSON.parse(data["noderedResponse"])["Action"];
							console.log(cameraStatus)
					result = cameraStatus+"ed"
						}
						else {
							console.log("Camera Not Connected Today")
							result = "Camera Not Connected Today"
						}
					
					})
					.catch((error) => {
						console.log(error);// This is where you run code if the server returns any errors\
						result = error
						
					})
					.finally(()=> {
						document.getElementById("statusDiv").innerText = result;
					})
				
					return result
		}

populateStatus()

        </script>
        
<script src="styles/Light-BS-dashboard-CT/assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="styles/Light-BS-dashboard-CT/assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="styles/Light-BS-dashboard-CT/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="styles/Light-BS-dashboard-CT/assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!--  Chartist Plugin  -->
<script src="styles/Light-BS-dashboard-CT/assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="styles/Light-BS-dashboard-CT/assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="styles/Light-BS-dashboard-CT/assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="styles/Light-BS-dashboard-CT/assets/js/demo.js"></script>

</html>